<!DOCTYPE html>
<html>
<head>
    <script src="nutella_lib.js" charset="utf-8"></script>

</head>

<dom-module id="nutella-client">
    <style>

    </style>
    <template>


    </template>

    <script>


        //var nutella = {};

        // element registration
        Polymer({
            is: 'nutella-client',

            // add properties and methods on the element's prototype
            properties: {

                // declare properties for the element's public API
                nutella: {
                    type: Object,
                    notify: true,
                    value: {}
                },
                connected: {
                    type: Boolean,
                    notify: true,
                    value: false,
                    observer: 'connectedChanged'
                },
                host: {
                    type: String,
                    notify: true,
                },
                appid: {
                    type: String,
                    notify: true,
                },
                runid: {
                    type: String,
                    notify: true,
                },
                componentid: {
                    type: String,
                    notify: true,
                },
                masterConfiguration: {
                    type: Object,
                    notify: true,
                    value: {},
                    observer: 'masterConfigurationChanged'

                }
            },
            masterConfigurationChanged: function (newValue, oldValue) {
                console.log('values', newValue, oldValue);
            },
            connectedChanged: function (newValue, oldValue) {
                var me = this;
                console.log('connected changed', newValue, oldValue);
                if( newValue === true ) {
                    this.nutella.net.request('master_configuration', {}, function (r) {
                        var r = response;
                        console.log('response', r);
                        me.masterConfiguration = r;
                    });
                }
            },
            ready: function () {
                this.masterConfiguration = {};
                var me = this;

                me.nutella = NUTELLA.init(this.host, this.appid, this.runid, this.componentid,
                        function (success) {
                            if (success) {
                                console.log('Successfully connected nutella!');
                                console.log('success done');
                                me.connected = true;
                            } else {
                                console.log('Error connecting!');
                            }
                        });


            }
        })
        ;
    </script>
</dom-module>